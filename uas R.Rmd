---
title: "uas R"
author: "Kelompok 1"
date: "2023-12-19"
output: html_document
---

## IMPORT LIBRARY
```{r}
library(dplyr)
library(ggplot2)
library(caret)
library(tidyverse)
library(psych) #Untuk melihat data normal
library(moments) #Untuk menghitung Pearson Kurtosis, Geary Skewness
library(outliers) #Untuk mendeteksi outliers
library(Metrics)
library(randomForest)
```


## LOADING DATASET
```{r}
admisi = read.csv('admisi.csv', header = TRUE, sep = ";")
profiling = read.csv('profiling.csv', header = TRUE, sep = ";")

# Menggabungkan dataset berdasarkan kolom ID
newdata = merge(profiling, admisi, by = "ID")
newdata
```

sum(is.na(newdata$IPK))

## DATA PREPROCESSING
```{r}

# Menghitung modus
modus_jenkel = names(sort(table(newdata$JENIS_KEL), decreasing = TRUE)[1])
modus_riset = names(sort(table(newdata$RISET), decreasing = TRUE)[1])
modus_lulus = names(sort(table(newdata$LULUS), decreasing = TRUE)[1])

# Mengganti nilai NA dengan modus
newdata$JENIS_KEL[is.na(newdata$JENIS_KEL)] = modus_jenkel
newdata$RISET[is.na(newdata$RISET)] = modus_riset
newdata$LULUS[is.na(newdata$LULUS)] = modus_lulus

# Transformasi faktor
newdata$JENIS_KEL = as.factor(newdata$JENIS_KEL)
newdata$LULUS = factor(newdata$LULUS, levels = c(1, 0), labels = c('Lulus', 'Tidak Lulus'))
newdata$RISET = as.factor(newdata$RISET)

# Mengganti koma (,) dengan titik (.) pada kolom "IPK"
newdata$IPK = gsub(",", ".", newdata$IPK)
newdata$MOT_LETTER = gsub(",", ".", newdata$MOT_LETTER)
newdata$REKOM_LETTER <- gsub(",", ".", newdata$REKOM_LETTER)

# Mengganti nilai NA pada nilai non-numerik
newdata$IPK = as.numeric(newdata$IPK)
newdata$MOT_LETTER = as.numeric(newdata$MOT_LETTER)
newdata$REKOM_LETTER = as.numeric(newdata$REKOM_LETTER)

# Menghitung mean
mean_rank = mean(newdata$Ranking_Uni_Asal, na.rm = TRUE)
mean_motl = mean(newdata$MOT_LETTER, na.rm = TRUE)
mean_koml = mean(newdata$REKOM_LETTER, na.rm = TRUE)

# Mengganti nilai NA dengan mean
newdata$Ranking_Uni_Asal[is.na(newdata$Ranking_Uni_Asal)] = mean_rank
newdata$MOT_LETTER[is.na(newdata$MOT_LETTER)] = mean_motl
newdata$REKOM_LETTER[is.na(newdata$REKOM_LETTER)] = mean_koml

str(newdata)
```

## MENGECEK DAN HAPUS OUTLIER

```{r}

# Loop untuk menampilkan boxplot satu per satu untuk variabel numerik
for (col in names(newdata)) {
  if (is.numeric(newdata[[col]])) {
    boxplot(newdata[[col]], main = col)
  }
}

# Menghapus Outliers
IQR_ipk = IQR(newdata$IPK)
upfen_ipk = quantile(newdata$IPK, 0.75) + 1.5 * IQR_ipk

IQR_koml = IQR(newdata$REKOM_LETTER)
lowfen_koml = quantile(newdata$REKOM_LETTER, 0.25) - 1.5 * IQR_koml

clean_newdata = subset(newdata, newdata$IPK <= upfen_ipk & newdata$REKOM_LETTER >= lowfen_koml)

# Mengecek apakah masih terdapat outliers
for (col in names(clean_newdata)) {
  if (is.numeric(clean_newdata[[col]])) {
    boxplot(clean_newdata[[col]], main = col)
  }
}

```

clean_newdata$REKOM_LETTER = sqrt(clean_newdata$REKOM_LETTER)

describe(clean_newdata)
for (col in names(clean_newdata)) {
  if (is.numeric(clean_newdata[[col]])) {
    hist(clean_newdata[[col]], main = col, xlab = "Value", col = "lightblue", border = "black")
  }
}


## FEATURE SELECTION
```{r}

control = trainControl(method="repeatedcv", number=10, repeats=3)
model = train(LULUS ~ ., data = clean_newdata[, setdiff(names(clean_newdata), "NAMA")], method = "lvq", preProcess = "scale", trControl = control)

# Estimasi Feature yang Penting
importance = varImp(model, scale=FALSE)

# plot importance
plot(importance)

```

## MODELLING
```{r}
# Subset data dengan feature yang dipilih
selected_features <- c("IPK", "RISET", "GRE", "TOEFL", "REKOM_LETTER", "MOT_LETTER", "JENIS_KEL", "USIA")
selected_data <- clean_newdata[, c("LULUS", selected_features)]

# Convert categorical variables to factors
selected_data$JENIS_KEL <- as.factor(selected_data$JENIS_KEL)

# Split the data into training and testing sets
set.seed(123)  # for reproducibility
train_indices <- createDataPartition(selected_data$LULUS, p = 0.8, list = FALSE)
train_data <- selected_data[train_indices, ]
test_data <- selected_data[-train_indices, ]

# Model Training
rf_model <- randomForest(LULUS ~ ., data = train_data)

# Model Prediction on the test set
predictions <- predict(rf_model, newdata = test_data)

# Evaluate the model
conf_matrix <- confusionMatrix(predictions, test_data$LULUS)
accuracy <- conf_matrix$overall["Accuracy"]
precision <- conf_matrix$byClass[["Pos Pred Value"]]

# Display evaluation metrics
print(paste("Accuracy:", accuracy))
print(paste("Precision:", precision))


```

