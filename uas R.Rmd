---
title: "uas R"
author: "Kelompok 1"
date: "2023-12-19"
output: html_document
---

## IMPORT LIBRARY
```{r}
library(dplyr)
library(ggplot2)
library(caret)
library(tidyverse)
library(psych) #Untuk melihat data normal
library(moments) #Untuk menghitung Pearson Kurtosis, Geary Skewness
library(outliers) #Untuk mendeteksi outliers
library(Metrics)
library(randomForest)
library(e1071)
library(janitor)
library(shiny)
```


## LOADING DATASET
```{r}

admisi = read.csv('admisi.csv', header = TRUE, sep = ";")
admisi
profiling = read.csv('profiling.csv', header = TRUE, sep = ";")
profiling

```



## DATA PREPROCESSING 1: HANDLING MISSING VALUE
```{r}

cek_NA_GRE = sum(is.na(admisi$GRE))
cek_NA_TOEFL = sum(is.na(admisi$TOEFL))
cek_NA_MLETTER = sum(is.na(admisi$MOT_LETTER))
cek_NA_RLETTER = sum(is.na(admisi$REKOM_LETTER))
cek_NA_LULUS = sum(is.na(admisi$LULUS))
cek_NA_USIA = sum(is.na(profiling$USIA))
cek_NA_JENKEL = sum(is.na(profiling$JENIS_KEL))
cek_NA_RUA = sum(is.na(profiling$Raking_Uni_Asal))
cek_NA_IPK = sum(is.na(profiling$IPK))
cek_NA_RISET = sum(is.na(profiling$RISET))

# Menghitung modus
modus_jenkel = names(sort(table(profiling$JENIS_KEL), decreasing = TRUE)[1])
modus_riset = names(sort(table(profiling$RISET), decreasing = TRUE)[1])
modus_lulus = names(sort(table(admisi$LULUS), decreasing = TRUE)[1])

# Mengganti nilai NA dengan modus
profiling$JENIS_KEL[is.na(profiling$JENIS_KEL)] = modus_jenkel
profiling$RISET[is.na(profiling$RISET)] = modus_riset
admisi$LULUS[is.na(admisi$LULUS)] = modus_lulus

# Transformasi faktor
profiling$JENIS_KEL = as.factor(profiling$JENIS_KEL)
admisi$LULUS = factor(admisi$LULUS, levels = c(1, 0), labels = c('Lulus', 'Tidak Lulus'))
profiling$RISET = as.factor(profiling$RISET)

# Mengganti koma (,) dengan titik (.) pada kolom "IPK"
profiling$IPK = gsub(",", ".", profiling$IPK)
admisi$MOT_LETTER = gsub(",", ".", admisi$MOT_LETTER)
admisi$REKOM_LETTER <- gsub(",", ".", admisi$REKOM_LETTER)

# Mengganti nilai NA pada nilai non-numerik
profiling$IPK = as.numeric(profiling$IPK)
admisi$MOT_LETTER = as.numeric(admisi$MOT_LETTER)
admisi$REKOM_LETTER = as.numeric(admisi$REKOM_LETTER)

# Menghitung mean
mean_rank = mean(profiling$Ranking_Uni_Asal, na.rm = TRUE)
mean_motl = mean(admisi$MOT_LETTER, na.rm = TRUE)
mean_koml = mean(admisi$REKOM_LETTER, na.rm = TRUE)

# Mengganti nilai NA dengan mean
profiling$Ranking_Uni_Asal[is.na(profiling$Ranking_Uni_Asal)] = mean_rank
admisi$MOT_LETTER[is.na(admisi$MOT_LETTER)] = mean_motl
admisi$REKOM_LETTER[is.na(admisi$REKOM_LETTER)] = mean_koml

str(admisi)
str(profiling)

```


## DATA PREPROCESSING 2A: HANDLING DUPLICATED DATA ADMISI
```{R}

# Cek Data Duplikat
cek_admisi = get_dupes(admisi)
cek_admisi

# Mempertahankan satu baris dari setiap kelompok duplikat
newdata_admisi = distinct(admisi, .keep_all = TRUE)

```


## DATA PREPROCESSING 2B: HANDLING DUPLICATED DATA PROFILING
```{r}

# Cek Data Duplikat
cek_profiling = get_dupes(profiling)
cek_profiling

# Mempertahankan satu baris dari setiap kelompok duplikat
newdata_profiling = distinct(profiling, .keep_all = TRUE)

```


## DATA PREPROCESSING 3A: HANDLING OUTLIER ADMISI

```{r}

# Loop untuk menampilkan boxplot satu per satu untuk variabel numerik
for (col in names(newdata_admisi)) {
  if (is.numeric(newdata_admisi[[col]])) {
    boxplot(newdata_admisi[[col]], main = col)
  }
}

# Menghapus Outliers
IQR_koml = IQR(newdata_admisi$REKOM_LETTER)
lowfen_koml = quantile(newdata_admisi$REKOM_LETTER, 0.25) - 1.5 * IQR_koml

clean_admisi = subset(newdata_admisi, REKOM_LETTER >= lowfen_koml)

# Mengecek apakah masih terdapat outliers
for (col in names(clean_admisi)) {
  if (is.numeric(clean_admisi[[col]])) {
    boxplot(clean_admisi[[col]], main = col)
  }
}

```



## DATA PREPROCESSING 3B: HANDLING OUTLIER PROFILING

```{r}

# Loop untuk menampilkan boxplot satu per satu untuk variabel numerik
for (col in names(newdata_profiling)) {
  if (is.numeric(newdata_profiling[[col]])) {
    boxplot(newdata_profiling[[col]], main = col)
  }
}

# Menghapus Outliers
IQR_ipk = IQR(newdata_profiling$IPK)
upfen_ipk = quantile(newdata_profiling$IPK, 0.75) + 1.5 * IQR_ipk

clean_profiling = subset(newdata_profiling, IPK <= upfen_ipk)

# Mengecek apakah masih terdapat outliers
for (col in names(clean_profiling)) {
  if (is.numeric(clean_profiling[[col]])) {
    boxplot(clean_profiling[[col]], main = col)
  }
}

```


## MERGE DATASET
```{r}

# Menggabungkan dataset berdasarkan kolom ID
newdata = merge(clean_profiling, clean_admisi, by = "ID")
newdata

```


## FEATURE SELECTION
```{r}

control = trainControl(method="repeatedcv", number=10, repeats=3)
model = train(LULUS ~ ., data = newdata[, setdiff(names(newdata), "NAMA")], method = "lvq", preProcess = "scale", trControl = control)

# Estimasi Feature yang Penting
importance = varImp(model, scale=FALSE)

# plot importance
plot(importance)

```

## SPLIT DATA
```{r}
# Subset data dengan feature yang dipilih
selected_features <- c("IPK", "RISET", "GRE", "TOEFL", "REKOM_LETTER", "MOT_LETTER", "JENIS_KEL", "USIA")
selected_data <- newdata[, c("LULUS", selected_features)]

# Convert categorical variables to factors
selected_data$JENIS_KEL <- as.factor(selected_data$JENIS_KEL)

# Split the data into training and testing sets
set.seed(123)  # for reproducibility
train_indices <- createDataPartition(selected_data$LULUS, p = 0.8, list = FALSE)
train_data <- selected_data[train_indices, ]
test_data <- selected_data[-train_indices, ]

```


## Model 1 (RF)
```{r}

# Model Training
rf_model <- randomForest(LULUS ~ ., data = train_data)

# Model Prediction on the test set
predictions <- predict(rf_model, newdata = test_data)

# Evaluate the model
conf_matrix <- confusionMatrix(predictions, test_data$LULUS)
accuracy <- conf_matrix$overall["Accuracy"]
precision <- conf_matrix$byClass[["Pos Pred Value"]]

# Display evaluation metrics
print(paste("Accuracy:", accuracy))
print(paste("Precision:", precision))


```

## MODEL 2 (SVM)
```{r}
# Model Training - Support Vector Machine (SVM)
svm_model <- svm(LULUS ~ ., data = train_data)

# Model Prediction on the test set
predictions_svm <- predict(svm_model, newdata = test_data)

# Evaluate the model
conf_matrix_svm <- confusionMatrix(predictions_svm, test_data$LULUS)
accuracy_svm <- conf_matrix_svm$overall["Accuracy"]
precision_svm <- conf_matrix_svm$byClass[["Pos Pred Value"]]

# Display evaluation metrics for SVM
print(paste("SVM Accuracy:", accuracy_svm))
print(paste("SVM Precision:", precision_svm))
```


## Model 3 (LR)
```{r}

# Model Training - Logistic Regression (LR)
lr_model = glm(LULUS ~ ., data = train_data, family = "binomial")

# Model Prediction on the test set
predictions_lr = predict(lr_model, newdata = test_data, type = "response")


# Convert predicted probabilities to class labels
predicted_classes_lr = ifelse(predictions_lr > 0.5, "Lulus", "Tidak Lulus")
predicted_classes_lr = as.factor(predicted_classes_lr)

# Evaluate the model
conf_matrix_lr = confusionMatrix(data=predicted_classes_lr, 
  reference=test_data$LULUS)

#conf_matrix_lr <- confusionMatrix(factor(predicted_classes_lr), test_data$LULUS)
accuracy_lr = conf_matrix_lr$overall["Accuracy"]
precision_lr = conf_matrix_lr$byClass[["Pos Pred Value"]]

# Display evaluation metrics for LR
print(paste("LR Accuracy:", accuracy_lr))
print(paste("LR Precision:", precision_lr))


```



# #shiny sementara
```{r}
ui = fluidPage(
  titlePanel("Judul"),
  sidebarLayout(
    sidebarPanel(
      selectInput('JENIS_KEL', 'Pilih Jenis Kelamin Anda', choices = c('Perempuan', 'Laki-Laki'), 
                  selected = 'Perempuan'),
      sliderInput('USIA', 'Pilih Usia Anda', 
                  min = 1,
                  max = 50,
                  value = 0),
      numericInput('IPK','Masukan IPK Anda : ', value=0),
      numericInput('TOEFL','Masukan Skor TOEFL Anda : ', value=0),
      numericInput('GRE','Masukan Skor Gre Anda : ', value=0),
      numericInput('REKOM_LETTER','Masukan Skor REKOM_LETTER Anda : ', value=0),
      numericInput('MOT_LETTER','Masukan Skor MOT_LETTER Anda : ', value=0),
      selectInput('RISET', 'Apakah Anda Melakukan Riset Sebelumnya', choices = c('Ya', 'Tidak'), 
                  selected = 'Ya'),
      actionButton('hitung', 'Prediksi Kelulusan')
    ), 
    mainPanel(
      textOutput('hasil')
    )
  )
)

server = function(input, output){
  observeEvent(input$hitung, {
    predictions <- predict(model, newdata=data.frame(JENIS_KEL=input$JENIS_KEL, USIA=input$USIA, 
                                                     IPK=input$IPK, TOEFL=input$TOEFL, GRE=input$GRE, 
                                                     REKOM_LETTER=input$REKOM_LETTER, MOT_LETTER=input$MOT_LETTER,
                                                     RISET=input$RISET))
    output$hasil <- renderText({paste('Hasil Prediksi Kelulusan adalah', predictions)})
    })
}

shinyApp(ui=ui, server=server)
```